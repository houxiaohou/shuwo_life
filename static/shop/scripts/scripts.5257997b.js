"use strict";angular.module("shuwoShopApp",["ngCookies","frapontillo.bootstrap-switch","ui.router","infinite-scroll"]).config(["$urlRouterProvider","$stateProvider","$httpProvider",function(a,b,c){var d=["$rootScope","$q","$injector",function(a,b){function c(a){return a}function d(a){var c=a.status;return 401==c?void alert("用户身份不正确，请重新进入"):b.reject(a)}return function(a){return a.then(c,d)}}];c.responseInterceptors.push(d),c.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",c.defaults.transformRequest=function(a){return void 0===a?a:$.param(a)},a.otherwise("/"),b.state("shuwoShop",{"abstract":!0,url:"",templateUrl:"views/base.html"}).state("shuwoShop.main",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("shuwoShop.order",{"abstract":!0,url:"/order",template:"<ui-view />"}).state("shuwoShop.order.detail",{url:"/{id:[0-9]{1,20}}",templateUrl:"views/order.detail.html",controller:"OrderDetailCtrl"}).state("shuwoShop.order.invalid",{url:"/{id:[0-9]{1,20}}/invalid",templateUrl:"views/order.invalid.html",controller:"OrderInvalidCtrl"}).state("shuwoShop.shop",{url:"/shop",templateUrl:"views/shop.html",controller:"ShopCtrl"}).state("shuwoShop.product",{"abstract":!0,url:"/product",template:"<ui-view />"}).state("shuwoShop.product.list",{url:"",templateUrl:"views/product.list.html",controller:"ProductCtrl"}).state("shuwoShop.product.detail",{url:"/{id:[0-9]{1,10}}",templateUrl:"views/product.detail.html",controller:"ProductDetailCtrl"})}]).run(["$http","$cookies",function(a,b){var c=b.stoken;c="KWm4nbAiCszGUlKZLcEFVg==",a.defaults.headers.common.Authorization=c,FastClick.attach(document.body)}]),angular.module("shuwoShopApp").controller("MainCtrl",["$scope","page","order",function(a,b,c){function d(){a.loading=!0,a.orders=[],a.start=0,a.end=!1,a.loadMore=function(){a.end||(a.loading=!0,c.listOrders(a.start,e,a.orderStatus.value).success(function(b){b.length<e&&(a.end=!0),a.loading=!1,a.orders.push.apply(a.orders,b),a.start+=e}).error(function(){a.loading=!1}))},a.loadMore()}b.setFooterNav("order"),b.showFooter(),a.status=[{label:"全部订单",value:-1},{label:"未处理订单",value:0},{label:"已确认订单",value:1},{label:"无效订单",value:2}],a.orderStatus=a.status[0];var e=5;d(),a.$watch("orderStatus",function(a,b){a!==b&&d()}),a.isNaN=isNaN}]),angular.module("shuwoShopApp").controller("BaseCtrl",["$scope","page",function(a,b){a.page=b}]),angular.module("shuwoShopApp").service("page",function(){var a="order",b=!0;return{setFooterNav:function(b){a=b},getFooterNav:function(){return a},hideFooter:function(){b=!1},showFooter:function(){b=!0},hasFooter:function(){return b}}}),angular.module("shuwoShopApp").controller("OrderDetailCtrl",["$scope","$state","$stateParams","order","page",function(a,b,c,d,e){e.hideFooter(),a.loading=!0;var f=c.id;d.getOrderById(f).success(function(b){a.order=b,a.loading=!1}),a.confirmWeight=function(){var c=[];for(var e in a.order.productdetail){var f=a.order.productdetail[e];if("1"==f.attribute){if(void 0===f.weight)return void alert("先输入准确的重量");c.push({orderproductid:f.orderproductid,weight:f.weight})}"2"==f.attribute&&c.push({orderproductid:f.orderproductid,weight:250*f.quantity}),"3"==f.attribute&&c.push({orderproductid:f.orderproductid,weight:f.quantity})}d.confirmWeight({weightdetail:JSON.stringify(c)}).success(function(){b.go("shuwoShop.main")})}}]),angular.module("shuwoShopApp").controller("OrderInvalidCtrl",["$scope","$state","$stateParams","order","page",function(a,b,c,d,e){e.hideFooter(),a.loading=!0;var f=c.id;d.getOrderById(f).success(function(b){a.order=b,a.loading=!1}),a.reasones=["距离太远","未到起送价","信息有误","其他"],a.reason="",a.choseReason=function(b){a.reason=b},a.confirm=function(){return""==a.reason?void alert("请选择原因"):void d.cancelOrder(f,a.reason).success(function(){b.go("shuwoShop.main")})}}]),angular.module("shuwoShopApp").controller("ShopCtrl",["$scope","$state","page","shop",function(a,b,c,d){c.setFooterNav("shop"),c.showFooter(),a.loading=!0,d.getMyShop().success(function(b){a.loading=!1,b.isopen="1"==b.isopen,a.shop=b}),a.updateShop=function(){var c=angular.copy(a.shop);c.isopen=a.shop.isopen?1:0,d.updateShop(c).success(function(){b.reload()})},a.shopStatus=function(){var c=angular.copy(a.shop);c.isopen=a.shop.isopen?0:1,d.changeShopStatus(c).success(function(){b.reload()})}}]),angular.module("shuwoShopApp").controller("ProductCtrl",["$scope","page","product",function(a,b,c){b.setFooterNav("product"),b.showFooter(),a.loading=!0,c.listAllProducts().success(function(b){a.products=[];for(var c in b){var d=b[c];d.issale="1"==d.issale,a.products.push(d)}a.loading=!1}),a.changeProduct=function(a){c.changeProductStatus(a)}}]),angular.module("shuwoShopApp").controller("ProductDetailCtrl",["$scope","$state","$stateParams","page","product",function(a,b,c,d,e){d.setFooterNav("product"),d.hideFooter();var f=c.id;a.loading=!0,e.getProductById(f).success(function(b){b.discount=Number(b.discount),b.unitweight=Number(b.unitweight),a.product=b,a.loading=!1}),a.updateProduct=function(){var c=a.product;c.issale=c.issale?1:0,e.updateProduct(c).success(function(){b.go("shuwoShop.product.list")})}}]),angular.module("shuwoShopApp").service("order",["$http","constants",function(a,b){return{listOrders:function(c,d,e){return a.get(b.API.order,{params:{start:c,count:d,status:e}})},getOrderById:function(c){return a.get(b.API.singleOrder+"/"+c)},confirmWeight:function(c){return a.post(b.API.weight,c)},cancelOrder:function(c,d){return a.post(b.API.orderCancel,{id:c,ordernotes:d})}}}]),angular.module("shuwoShopApp").service("constants",function(){var a="/shuwo/project/Api";return{API:{shop:a+"/shop",shopOpen:a+"/shop/isopen",myShop:a+"/usershop",order:a+"/shop/orders",singleOrder:a+"/order",allProducts:a+"/shop/allproducts",product:a+"/product",weight:a+"/weight",orderCancel:a+"/ordercancel"}}}),angular.module("shuwoShopApp").filter("orderStatus",function(){return function(a){return 0==a?"待确认":1==a?"已确认":2==a?"无效":void 0}}),angular.module("shuwoShopApp").service("product",["$http","constants",function(a,b){return{listAllProducts:function(){return a.get(b.API.allProducts)},getProductById:function(c){return a.get(b.API.product+"/"+c)},changeProductStatus:function(c){return a.post(b.API.product+"/"+c.productid+"/issale",{issale:c.issale?1:0})},updateProduct:function(c){return a.post(b.API.product+"/"+c.productid,c)}}}]),angular.module("shuwoShopApp").service("shop",["$http","constants",function(a,b){return{getMyShop:function(){return a.get(b.API.myShop)},changeShopStatus:function(c){return a.post(b.API.shopOpen,c)},updateShop:function(c){return a.post(b.API.myShop,c)}}}]),angular.module("shuwoShopApp").filter("weight",function(){return function(a){return 500>a?a+"g":Number(a/1e3).toFixed(2)+"kg"}});